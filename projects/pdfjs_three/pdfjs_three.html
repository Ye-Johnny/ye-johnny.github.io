<!DOCTYPE html>
<html>
<head>
  <title>我的作品集 PDF js+Three</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
  <div id="pdf-container"></div>
  <script>
    // 初始化Three.js场景
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // 设置相机位置
    camera.position.z = 5;

    // 动画循环
    function animate() {
      requestAnimationFrame(animate);
      // 如果有平面对象，则让它旋转
      if (window.plane) {
            window.plane.rotation.y += 0.01;
         }
      renderer.render(scene, camera);
    }
    // animate();

    const pdfUrl = 'assets/portfolio-v1.pdf';


    // 检查PDF文件是否存在
    fetch(pdfUrl).then(response => {
          if (!response.ok) {
            console.error('PDF file not found:', pdfUrl);
            // 使用默认文本作为替代
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 400;
            canvas.height = 300;
            ctx.fillStyle = '#f0f0f0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#333';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('PDF文件未找到', canvas.width/2, canvas.height/2);
            processCanvas(canvas);
          } else {
            // 文件存在，加载PDF
            response.blob().then(blob => {
              const reader = new FileReader();
              reader.onload = function() {
                const typedarray = new Uint8Array(reader.result);
                pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                  pdf.getPage(2).then(page => {
                    const viewport = page.getViewport({ scale: 1.5 });
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    page.render({ canvasContext: context, viewport: viewport }).promise.then(() => {
                      processCanvas(canvas);
                    });
                 });
                });
              };
              reader.readAsArrayBuffer(blob);
            });
          }
        }).catch(error => {
          console.error('Error checking PDF file:', error);
        });
    
        // 处理canvas并创建Three.js对象
        function processCanvas(canvas) {
          const texture = new THREE.CanvasTexture(canvas);
          const material = new THREE.MeshBasicMaterial({ map: texture });
          const plane = new THREE.Mesh(new THREE.PlaneGeometry(2, 3), material);
         scene.add(plane);
          window.plane = plane; // 保存引用以便在动画中使用
        }
      </script>

</body>
</html>
